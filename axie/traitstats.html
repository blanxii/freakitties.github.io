<html>
    <head>
        <title>Axie Trait Stats</title>
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116189657-1"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-116189657-1');
        </script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <style>
            body {background-color: #efefef;}
        </style>
        <script type="text/javascript" src="data.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" integrity="sha384-1UXhfqyOyO+W+XsGhiIFwwD3hsaHRz2XDGMle3b8bXPH5+cMsXVShDoHA3AH/y/p" crossorigin="anonymous">
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js" integrity="sha384-Z9D45cp3elqajO+xEyjRTIK1Gr3eYsXiyCPIKNog1sIQzpo2fqFDqFdADGiJjzOv" crossorigin="anonymous"></script>
        <style>
            .dropdown-menu>li>a, .dropdown-menu {
                color: white;
                background-color: #6c757d;
            }
        </style>
    </head>
<script>


    function render(data, type, row, meta) {
        if(type === 'display'){
            data = '<img width=60 src="' + data + '" onerror="this.src=\'unknown.png\'"/><br/>' + row.name;
        }
        return data;
    }

    function renderFloat(data, type, row, meta) {
        if (typeof data == "number") {
            return data.toFixed(2);
        } else {
            return data;
        }
    }

var bodyParts;
$(document).ready(function(){
    $.ajax({
        url: "../header.html",
        cache: false,
        dataType: "html",
        success: function(data) {
            $("#headerDiv").html(data);
        }
    });
    $.get("https://axieinfinity.com/api/body-parts", function(data) {
        bodyParts = data;

        data = [];
        for (let p in bodyParts) {
            let part = bodyParts[p];
            let key = part.name + "_" + part.type + "_" + part.class;
            //console.log(key);
            let row;
            if (!(key in traits)) {
                console.log("Unknown trait: " + JSON.stringify(bodyParts[p]));
                row = {image: "unknown.png", name: part.name.replace(/"/g, "&quot;").replace(/</g, '&lt;'), type: part.type.replace(/"/g, "&quot;").replace(/</g, '&lt;'), class: part.class.replace(/"/g, "&quot;").replace(/</g, '&lt;')};
            } else {
                row = {image: traits[key].image.replace(/"/g, "&quot;").replace(/</g, '&lt;'), name: part.name.replace(/"/g, "&quot;").replace(/</g, '&lt;'), type: part.type.replace(/"/g, "&quot;").replace(/</g, '&lt;'), class: part.class.replace(/"/g, "&quot;").replace(/</g, '&lt;')};
            }
            if (part.moves.length > 0) {
                row.moveType = part.moves[0].type.replace(/"/g, "&quot;").replace(/</g, '&lt;');
                row.moveName = part.moves[0].name.replace(/"/g, "&quot;").replace(/</g, '&lt;');
                row.attack = parseInt(part.moves[0].attack);
                row.defense = parseInt(part.moves[0].defense);
                row.accuracy = parseInt(part.moves[0].accuracy);
                row.effectiveAttack = row.attack * (row.accuracy/100);
                row.adRatio = row.effectiveAttack / row.defense;
                row.adMultiple = row.effectiveAttack * row.defense;
                row.effects = "";
                if (part.moves[0].effects.length > 0) {
                    row.effects = part.moves[0].effects[0].name.replace(/"/g, "&quot;").replace(/</g, '&lt;');
                    if (part.moves[0].effects[0].type == "passive") {
                        row.effects += " (passive)";
                    }
                    row.effects += ": " + part.moves[0].effects[0].description.replace(/"/g, "&quot;").replace(/</g, '&lt;');
                }
            } else {
                row.moveType = row.moveName = row.attack = row.defense = row.accuracy = row.effects = row.effectiveAttack = row.adRatio = row.adMultiple = "-";
            }
            data.push(row);
        }


        var axieTable = $('#axieTable').DataTable({
            data: data,
            columns: [
            {title: "Part", data: "image", "render": render},
            {title: "Move Name", data: "moveName"},
            {title: "Type", data: "type"},
            {title: "Class", data: "class"},
            {title: "Move Type", data: "moveType"},
            {title: "Attack", data: "attack", searchable: false},
            {title: "Defense", data: "defense", searchable: false},
            {title: "Accuracy", data: "accuracy", searchable: false},
            /*
            {title: "Effective attack", data: "effectiveAttack", searchable: false, render: renderFloat},
            {title: "A/D", data: "adRatio", searchable: false,render: renderFloat},
            {title: "A*D", data: "adMultiple", searchable: false,render: renderFloat},
            */
            {title: "Effect", data: "effects"},
            ],
            "language": {"search": "Search (part name, type, class, move type, or effect):"},
            pageLength: 250,
            "columnDefs": [
                { className: "text-center", "targets": [0, 2, 3, 4, 5, 6, 7] }
            ]

        });
    });
});
</script>

    <!-- header -->
    <div id="headerDiv"></div><br/>

    <div id="mainDiv" class="container">
        <table class="table display" id="axieTable">
            <thead>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</html>